---
layout: post
date: 2025-01-08
catalogue: "AWS"
subject: "AWS CodePipeline"
title: "AWS CodePipeline CI/CD êµ¬ì¶•"
description: "AWS CodePipelineë¡œ ê°„ë‹¨íˆ ë§Œë“¤ì–´ë³´ëŠ” CI/CD"
author: tiaz0128
permalink: /AWS/5
tags: [AWS, ci/cd, CodePipeline]
mermaid: true
---

## CI/CD

---

CI/CDëŠ” í˜„ëŒ€ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ í•µì‹¬ì ì¸ ê°œë°œ ë°©ë²•ë¡ ì…ë‹ˆë‹¤. CI(Continuous Integration)ëŠ” ê°œë°œìë“¤ì´ ì½”ë“œ ë³€ê²½ì‚¬í•­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ë©”ì¸ ë¸Œëœì¹˜ì— ë³‘í•©í•˜ëŠ” ê³¼ì •ì„ ìë™í™”í•˜ëŠ” ê²ƒì„ ë§í•˜ë©°, CDëŠ” Continuous Delivery(ì§€ì†ì  ì œê³µ)ì™€ Continuous Deployment(ì§€ì†ì  ë°°í¬)ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

### CI (Continuous Integration)

- ì—¬ëŸ¬ ê°œë°œìì˜ ì½”ë“œ ë³€ê²½ì‚¬í•­ì„ ì •ê¸°ì ìœ¼ë¡œ í†µí•©
- ìë™í™”ëœ ë¹Œë“œì™€ í…ŒìŠ¤íŠ¸ ì§„í–‰
- ì½”ë“œ í’ˆì§ˆ ìœ ì§€ì™€ ë²„ê·¸ ì¡°ê¸° ë°œê²¬

### CD (Continuous Delivery/Deployment)

- Continuous Delivery: í”„ë¡œë•ì…˜ í™˜ê²½ìœ¼ë¡œ ë°°í¬í•  ìˆ˜ ìˆëŠ” ìƒíƒœ ìœ ì§€
- Continuous Deployment: í”„ë¡œë•ì…˜ í™˜ê²½ê¹Œì§€ ìë™ ë°°í¬


## React App + Docker NGINX

---

[ì†ŒìŠ¤ì½”ë“œ Link](https://github.com/tiaz0128/docker-react){:target="_blank"}

React ì•±ì„ ë¹Œë“œí•˜ì—¬ Docker NGINX ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤. ì´ ì½”ë“œë¥¼ AWS CodePipelineì„ ì´ìš©í•˜ì—¬ EC2ì— ë°°í¬í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ì˜ ëª…ë ¹ìœ¼ë¡œ ë¡œì»¬ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```bash
$ docker build -t docker-react .

$ docker run -it -d -p 8080:80 --name web docker-react
```

## AWS CodePipeline

---

AWS CodePipelineì€ CI/CD ìŠ¤í…Œì´ì§€ë¥¼ ëª¨ë¸ë§í•˜ê³  ìë™í™”í•˜ëŠ” AWSì˜ ì™„ì „ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì½”ë“œ ë³€ê²½ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ë° ë°°í¬ ìŠ¤í…Œì´ì§€ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ì•ˆì •ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—…ë°ì´íŠ¸ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

### AWS CodePipeline êµ¬ì„±ë„

![AWS CodePipeline CI/CD](/assets/img/content/AWS/005/001.png)

ì—¬ê¸°ì„œëŠ” AWS CodePipelineë¥¼ í†µí•´ ê° ìŠ¤í…Œì´ì§€ì— ë‹¤ìŒ ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°í•´ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.

- AWS CodeCommit
- AWS CodeBuild
- AWS CodeDeploy

AWS CodeCommitìœ¼ë¡œ gitì„ ì—°ë™í•˜ê³  AWS CodeBuildë¡œ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©°, AWS CodeDeployë¥¼ í†µí•´ EC2ì— ì½”ë“œë¥¼ ë°°í¬í•´ ë³´ë„ë¡í•˜ê² ìŠµë‹ˆë‹¤.

### ì•„í‹°íŒ©íŠ¸(artifacts)

**ê° ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ìƒì„±ë˜ëŠ” ê²°ê³¼ë¬¼ì„ ì•„í‹°íŒ©íŠ¸(artifacts)**{:.orange}ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. ì´ ì•„í‹°íŒ©íŠ¸ê°€ ì–´ë–»ê²Œ ìƒì„±ë˜ê³  ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ìœ ì‹¬íˆ ê´€ì°°í•´ë³´ì„¸ìš”. ì´ íë¦„ì„ ë”°ë¼ê°€ë©´ CI/CDë¥¼ ë³´ë‹¤ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

## CI/CD êµ¬ì„±ë„

---

![AWS CodePipeline CI/CD](/assets/img/content/AWS/005/004.png)

1. AWS CodePipelineë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ CI/CD êµ¬ì„±
2. AWS CodeBuildì—ì„œ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  Docker Hubì— push
3. AWS CodeDeployë¡œ Docker ì´ë¯¸ì§€ë¥¼ pull ë°›ì•„ì„œ Amazon EC2ì— ë°°í¬

## AWS CodeCommit

---

AWS CodeCommitì€ AWSì—ì„œ ì œê³µí•˜ëŠ” ë²„ì „ ê´€ë¦¬ git ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. GitHubê³¼ ìœ ì‚¬í•œ ì„œë¹„ìŠ¤ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤. AWS Commit ë˜ëŠ” GitHubì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ AWS CodePipelineì„ í†µí•´ ì•„í‹°íŒ©íŠ¸ë¡œ S3ì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![buildspec.yml](/assets/img/content/AWS/005/007.png){:.img-m}

### ì£¼ì˜ ì‚¬í•­

2024ë…„ 7ì›” 25ì¼ ë¶€ë¡œ ì‹ ê·œë¡œ ê°€ì…í•œ AWS Accountì˜ AWS CodeCommit ë¦¬í¬ì§€í† ë¦¬ ìƒì„±ì´ ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤. ë˜í•œ ê¸°ì¡´ Accountë¼ë„ ì´ë¯¸ ìƒì„±ëœ AWS CodeCommit ë¦¬í¬ì§€í† ë¦¬ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì—¬ì „íˆ íšŒì‚¬ì—ì„œ AWS CodeCommitì„ ì‚¬ìš©í•˜ëŠ” ê³³ì´ ìˆê¸° ë•Œë¬¸ì—, ì—¬ê¸°ì„œëŠ” SSHë¡œ AWS CodeCommitì„ ì—°ê²° í•˜ê² ìŠµë‹ˆë‹¤. GitHub ë˜ëŠ” GitLabì„ ì´ìš©í•˜ì‹œë©´ ë‹¤ìŒ AWS CodeBuildë¡œ ë„˜ì–´ê°€ì„¸ìš”!

### ë¦¬í¬ì§€í† ë¦¬ ìƒì„±

AWS CodeCommitì—ì„œ ë¦¬í¬ì§€í† ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ê³  ìƒì„±í•©ë‹ˆë‹¤.

![AWS CodeCommit](/assets/img/content/AWS/005/002.png){:.img-m}

`> AWS CodeCommitìœ¼ë¡œ git ì €ì¥ì†Œë¥¼ ìƒì„±`{:.img-caption}

### SSH í¼ë¸”ë¦­ í‚¤ë¥¼ ì—…ë¡œë“œ

AWS CodeCommit ë¦¬í¬ì§€í† ë¦¬ë¥¼ SSHë¡œ ì—°ê²°í•˜ê² ìŠµë‹ˆë‹¤. [GitHubì™€ ì™„ì „íˆ ë™ì¼í•œ ë°©ì‹](/GitHub/1/#ssh-í‚¤-ìƒì„±-ë°-ë“±ë¡){:.none target="_blank"}ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`IAM`{:.path} - `ì‚¬ìš©ì`{:.path} - `ë³´ì•ˆ ìê²© ì¦ëª…`{:.path} - `AWS CodeCommitì— ëŒ€í•œ SSH í¼ë¸”ë¦­ í‚¤ ì—…ë¡œë“œ`{:.path} í•©ë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ ìƒì„±í•œ ë¹„ëŒ€ì¹­ í‚¤í˜ì–´ ì¤‘ì—ì„œ ê³µê°œí‚¤(id_rsa.pub)ë¥¼ ë“±ë¡í•´ì£¼ë©´ ë©ë‹ˆë‹¤. í¼ë¸”ë¦­ í‚¤ ì—…ë¡œë“œí•˜ë©´ `SSH í‚¤ ID`ê°€ ë‚˜ì˜¤ëŠ”ë° ì´ê°’ì€ SSH configì— ì‚¬ìš©í•˜ê²Œ ë  ê°’ì…ë‹ˆë‹¤.

```bash
$ ssh-keygen -t rsa
```

![AWS CodePipeline CI/CD](/assets/img/content/AWS/005/003.png)

### SSH config ì„¤ì •

SSH config íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ ê°’ì„ ì„¸íŒ…í•©ì‹œë‹¤.

- Host : `git-codecommit.*.amazonaws.com`
- User : `SSH í‚¤ ID`
- IdentityFile : `ë¹„ëŒ€ì¹­ í‚¤í˜ì–´ ì¤‘ì—ì„œ ê°œì¸í‚¤`

```text
Host git-codecommit.*.amazonaws.com
    User APKAZN6Q
    IdentityFile C:\Users\tiaz0128\.ssh\id_rsa
```

### git remote ì—°ê²°

AWS CodeCommitì— ìƒì„±ëœ ë ˆí¬ì§€í† ë¦¬ì˜ `URL ë³µì œ`{:.path} - `SSH`{:.path} ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì„œ git ì›ê²© ì €ì¥ì†Œë¡œ ë“±ë¡í•©ë‹ˆë‹¤.

```bash
$ git remote add aws ssh://git-codecommit.ap-northeast-2.amazonaws.com/v1/repos/docker-react
```

## AWS CodeBuild

---

AWS CodeBuildëŠ” Docker ì´ë¯¸ì§€ë¥¼ ë‚´ì—ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ë˜í•œ ì»¤ìŠ¤í…€ Docker ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ ë¹Œë“œ í™˜ê²½ì„ ì§ì ‘ êµ¬ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤. ì†ŒìŠ¤ ì•„í‹°íŒ©íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ `buildspec.yml` íŒŒì¼ì— ì •ì˜ëœ ê° ë‹¨ê³„(phases)ì— ë”°ë¼ ë™ì‘í•©ë‹ˆë‹¤.

- ì†ŒìŠ¤ ì½”ë“œ ì»´íŒŒì¼ / ë¹Œë“œ
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰

![buildspec.yml](/assets/img/content/AWS/005/010.png){:.img-m}

### í”„ë¡œì íŠ¸ ìƒì„±

1. AWS CodeBuildì—ì„œ `í”„ë¡œì íŠ¸ ë¹Œë“œ`{:.path} - `í”„ë¡œì íŠ¸ ìƒì„±`{:.path} í•©ë‹ˆë‹¤.
2. `ì†ŒìŠ¤ ê³µê¸‰ì`{:.path}ëŠ” AWS CodeCommit / GitHub ì¤‘ì— ì„ íƒí•©ë‹ˆë‹¤.
3. `í™˜ê²½`{:.path} - `ì¶”ê°€ êµ¬ì„±`{:.path} - `ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê±°ë‚˜ ë¹Œë“œì˜ ê¶Œí•œì„ ìŠ¹ê²©í•˜ë ¤ë©´ ì´ í”Œë˜ê·¸ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.`{:.path} ì„ íƒ
4. `í™˜ê²½`{:.path} - `ì¶”ê°€ êµ¬ì„±`{:.path} - `íŒŒë¼ë¯¸í„° ìƒì„±`{:.path}ë¥¼ í†µí•´ì„œ ì¤‘ìš”í•œ í™˜ê²½ë³€ìˆ˜ ê°’ë“¤ì„ ìƒì„±í•©ë‹ˆë‹¤.
  - DOCKER_USERNAME : Docker Hub ì•„ì´ë””
  - DOCKER_PASSWORD : Docker Hub ë¹„ë°€ë²ˆí˜¸
5. `Buildspec`{:.path} - `ë¹Œë“œ ì‚¬ì–‘`{:.path} - `buildspec íŒŒì¼ ì‚¬ìš©`{:.path} ì„ íƒ
6. `ì•„í‹°íŒ©íŠ¸`{:.path} - `ìœ í˜•`{:.path} - `ì•„í‹°íŒ©íŠ¸ ì—†ìŒ`{:.path}

### buildspec.yml

buildspec.ymlì€ ê° ë‹¨ê³„(phases) ë³„ë¡œ í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë°©ë²•ì„ ì •ì˜í•˜ëŠ” YAML í˜•ì‹ì˜ íŒŒì¼ì…ë‹ˆë‹¤. ì£¼ìš” ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- AWS Systems Managerì˜ parameter-storeì— ì €ì¥ëœ í™˜ê²½ë³€ìˆ˜ë¥¼ ì´ìš©
- Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° Docker Hubì— push
- artifacts í´ë” ë‚´ì— AWS CodeDeployì—ì„œ ì‚¬ìš©í•  íŒŒì¼ë“¤ ë³µì‚¬

ê° ì„¸ì…˜ì˜ ì„¸ë¶€ì •ë³´ëŠ” [CodeBuildì˜ ë¹Œë“œ ì‚¬ì–‘ ì°¸ì¡°](https://docs.aws.amazon.com/ko_kr/codebuild/latest/userguide/build-spec-ref.html){:.none target="_blank"}ë¥¼ ì°¸ê³  í•©ì‹œë‹¤.

```yml
version: 0.2
env:
  parameter-store:
    DOCKER_USERNAME: "/CodeBuild/DOCKER_USERNAME"
    DOCKER_PASSWORD: "/CodeBuild/DOCKER_PASSWORD"
    
phases:
  pre_build:
    commands:
      - mkdir -p artifacts    # artifacts ë””ë ‰í† ë¦¬ ìƒì„±
      - cp -r scripts/ artifacts/
      - cp appspec.yml artifacts/
      - ls -al artifacts
  build:
    commands:
      - docker build -t $DOCKER_USERNAME/docker-react .
  post_build:
    commands:
      - docker login docker.io -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
      - docker push $DOCKER_USERNAME/docker-react

artifacts:
  files:
    - "**/*"
  base-directory: artifacts
```

### AWS CodeBuild êµ¬ì„±ë„

ìœ„ì—ì„œ ì„¤ëª…ëŒ€ë¡œ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  Docker Hubì— push í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë‹¤ìŒ ìŠ¤í…Œì´ì§€ì¸ AWS CodeDeployì—ì„œ í•„ìš”í•œ íŒŒì¼ì„ ì•„í‹°íŒ©íŠ¸ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

![AWS CodeBuild](/assets/img/content/AWS/005/008.png){:.img-s}

`> AWS CodeBuildë¡œ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  Docker Hubì— push`{:.img-caption}

## AWS CodeDeploy

---

AWS CodeDeployëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ë¥¼ ìë™í™”í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. íƒœê·¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒ€ìƒ EC2ì˜ codedeploy agentë¥¼ í†µí•´ `appspec.yml` ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

![AWS CodeBuild](/assets/img/content/AWS/005/011.png){:.img-m}

### CodeDeploy ì—­í•  ìƒì„±

AWS CodeDeployì—ì„œ ë°°í¬ì— í•„ìš”í•œ ì—­í• (Role)ì„ ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.

- AWSCodeDeployRole

### ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±

ìš°ì„ ì€ AWS CodeDeployì—ì„œ `ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±`{:.path} - `ì»´í“¨íŒ… í”Œë«í¼`{:.path} - `EC2/ì˜¨í”„ë ˆë¯¸ìŠ¤`{:.path} ì„ íƒí•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±í•©ë‹ˆë‹¤.

### ë°°í¬ ê·¸ë£¹

ë‹¤ìŒ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ë°°í¬ ëŒ€ìƒ ì¸ìŠ¤í„´ìŠ¤ ê·¸ë£¹ì„ ìƒì„±í•©ë‹ˆë‹¤.

1. `ì„œë¹„ìŠ¤ ì—­í• `{:.path} - `ìƒì„±í•œ CodeDeploy ì—­í• `{:.path} ì„ íƒ
2. `ë°°í¬ ìœ í˜•`{:.path} - `í˜„ì¬ ìœ„ì¹˜`{:.path} ì„ íƒ
3. `í™˜ê²½ êµ¬ì„±`{:.path} - `Amazon EC2 ì¸ìŠ¤í„´ìŠ¤`{:.path} ì„ íƒ
4. `í™˜ê²½ êµ¬ì„±`{:.path} - `íƒœê·¸ ê·¸ë£¹`{:.path} - í‚¤, ê°’ ì…ë ¥
  - âš ï¸ì£¼ì˜ : Nameì€ ëŒ€ì†Œë¬¸ìë¥¼ ì •í™•íˆ Nameìœ¼ë¡œ ì…ë ¥í•©ë‹ˆë‹¤.
  - `Name` : `fe-server`
5. `ë¡œë“œ ë°¸ëŸ°ì„œ`{:.path} - `ë¡œë“œ ë°¸ëŸ°ì‹± í™œì„±í™”`{:.path} ì„ íƒ í•´ì œ

### appspec.yml

appspec.ymlì€ AWS CodeDeployì˜ í•µì‹¬ êµ¬ì„± íŒŒì¼ë¡œ, ë°°í¬ ê³¼ì •ê³¼ ì ˆì°¨ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. [CodeDeploy AppSpec íŒŒì¼ ì°¸ì¡°](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/reference-appspec-file.html){:.none target="_blank"}ë¥¼ ì°¸ê³  í•©ì‹œë‹¤.

- ì •í•´ì§„ ê° ìˆ˜ëª… ì£¼ê¸° ì´ë²¤íŠ¸ë§ˆë‹¤ hooksì„ í†µí•´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰
- BeforeInstall : cleanup.sh ìŠ¤í¬ë¦½íŠ¸ë¡œ ê¸°ì¡´ì˜ Docker ì»¨í„°ë„¤ì´ë„ˆë¥¼ ì¤‘ì§€í•˜ê³ 
- AfterInstall : update_container.sh ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒˆë¡œìš´ Docker ì´ë¯¸ì§€ë¥¼ pull ë°›ì•„ ì»¨í„°ì´ë„ˆë¥¼ ì‹¤í–‰

```yml
version: 0.0
os: linux
files:
  - source:  /
    destination: /home/ec2-user
    overwrite: true
file_exists_behavior: OVERWRITE

permissions:
  - object: /
    pattern: "**"
    owner: ec2-user
    group: ec2-user

hooks:
  BeforeInstall:
    - location: scripts/cleanup.sh
      runas: ec2-user
  AfterInstall:
    - location: scripts/update_container.sh
      runas: ec2-user
```

## ë°°í¬ ëŒ€ìƒ EC2

---

AWS CodeDeployê°€ ì§€ì •ëœ íƒœí¬ë¥¼ ê°€ì§„ EC2ì— codedeploy Agentë¥¼ í†µí•´ ì•„í‹°íŒ©íŠ¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ì•„í‹°íŒ©íŠ¸ ë‚´ë¶€ì— `appspec.yml`ì„ í†µí•´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ë˜ê³  ë°°í¬ê°€ ì´ë£¨ì–´ ì§‘ë‹ˆë‹¤.

![appspec.yml](/assets/img/content/AWS/005/012.png){:.img-m}

`> ì§€ì •ëœ íƒœê·¸ë¥¼ ê°€ì§„ EC2ì— appspec.yml íŒŒì¼ì´ ë™ì‘`{:.img-caption}

### EC2 ì´ë¦„ ë° íƒœê·¸

ë°°í¬ ëŒ€ìƒ EC2ë¥¼ `ì´ë¦„ ë° íƒœê·¸`{:.path} - `fe-server`{:.path}ë¡œ ìƒì„±í•¨ë‹ˆë‹¤. AWS CodeDeployëŠ” íƒœê·¸ ê·¸ë£¹ìœ¼ë¡œ ì§€ì •í•œ EC2ì˜ íƒœê·¸ ê¸°ë°˜ìœ¼ë¡œ ë°°í¬ ëŒ€ìƒì„ ì°¾ê¸° ë•Œë¬¸ì— ìƒì„±ì‹œ íƒœê·¸ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ëŠ”ê²Œ ì¤‘ìš”í•©ë‹ˆë‹¤.

![EC2 Name](/assets/img/content/AWS/005/006.png){:.img-m}

`> AWS CodeDeployëŠ” ë°°í¬ ëŒ€ìƒ EC2ë¥¼ ì´ë¦„ ë° íƒœê·¸ë¡œ ì°¾ëŠ”ë‹¤.`{:.img-caption}

### EC2 ì—­í• (Role) ë¶€ì—¬

EC2ì—ì„œ AWS CodeDeployë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” í•„ìš”í•œ ì—­í• (Role)ì„ ìƒì„±í•´ ì§€ì •í•©ë‹ˆë‹¤.

- AmazonEC2RoleforAWSCodeDeploy

### Docker ì„¤ì¹˜

EC2ì— Dockerë¥¼ ì„¤ì¹˜ í•©ë‹ˆë‹¤.

```bash
$ sudo yum -y install docker

$ sudo systemctl restart docker

$ sudo usermod -a -G docker ec2-user
```

### CodeDeploy Agent ì„¤ì¹˜

ë§ˆì§€ë§‰ìœ¼ë¡œ EC2 ë‚´ë¶€ì— AWS CodeDeployì™€ í†µì‹  í•  ìˆ˜ ìˆëŠ” Agentë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. [CodeDeploy ì—ì´ì „íŠ¸ ì„¤ì¹˜ ë©”ë‰´ì–¼](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/codedeploy-agent-operations-install-cli.html){:.none target="_blank"}ì„ ì°¸ê³ í•´ì„œ ì—ì´ì „íŠ¸ë¥¼ ì„¤ì¹˜ í•©ë‹ˆë‹¤.

```bash
$ wget https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/install

$ chmod +x ./install

$ sudo ./install auto
```

ë©”ì¸ ì—ì´ì „íŠ¸ ë¡œê·¸ëŠ” ì•„ë˜ì˜ ëª…ë ¹ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ EC2ì— `AmazonEC2RoleforAWSCodeDeploy` ê¶Œí•œì´ ìˆëŠ”ì§€ ì—­í• (Role)ì„ ë‹¤ì‹œ í•œë²ˆ í™•ì¸ í•©ë‹ˆë‹¤.

```bash
$ sudo tail -f /var/log/aws/codedeploy-agent/codedeploy-agent.log
```

## AWS CodePipelineë¡œ ì—°ê²°í•˜ê¸°

---

ì´ì œ AWS CodePipelineì„ í†µí•´ ê° ìŠ¤í…Œì´ì§€ì— ì„œë¹„ìŠ¤ë“¤ì„ ì—°ê²°í•©ë‹ˆë‹¤.

1. `íŒŒì´í”„ë¼ì¸ ìƒì„±`{:.path} - `Build custom pipeline`{:.path}
2. `ì†ŒìŠ¤ ìŠ¤í…Œì´ì§€ ì¶”ê°€`{:.path} - `ì†ŒìŠ¤ ê³µê¸‰ì`{:.path} AWS CodeCommit / GitHub ì¤‘ì— ì„ íƒ
3. `ë¹Œë“œ ìŠ¤í…Œì´ì§€ ì¶”ê°€`{:.path} - `Other build providers`{:.path} - `AWS CodeBuild`{:.path} ì„ íƒ
4. `ë°°í¬ ìŠ¤í…Œì´ì§€ ì¶”ê°€`{:.path} - `AWS CodeDeploy`{:.path} ì„ íƒ ë° `ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„`{:.path} / `ë°°í¬ ê·¸ë£¹`{:.path} ì„ íƒ

### ë°°í¬ í™•ì¸

git ë³€ê²½ì´ ë°œìƒí•˜ëŠ” ê²½ìš° Docker ì´ë¯¸ì§€ê°€ ë¹Œë“œ í›„ ë°°í¬ë˜ê³  ì»¨í…Œì´ë„ˆê°€ ë³€ê²½ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ EC2ì— ë°°í¬ê°€ ì œëŒ€ë¡œ ì´ë£¨ì–´ì§€ëŠ” ì•„ë˜ì˜ ëª…ë ¹ìœ¼ë¡œ ë¡œê·¸ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
$ sudo tail -f /opt/codedeploy-agent/deployment-root/deployment-logs/codedeploy-agent-deployments.log
```

## ë§ˆë¬´ë¦¬

---

ì—¬ê¸°ê¹Œì§€ Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ì†ŒìŠ¤ì½”ë“œë¥¼ AWS CodePipelineì„ í†µí•´ CI/CDë¥¼ êµ¬ì¶•í•´ë´¤ìŠµë‹ˆë‹¤.

- AWS CodeCommitì— gitì„ ì—°ê²°í•˜ê³ 
- AWS CodeBuildë¥¼ í†µí•´ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ ë° push
- AWS CodeDeployë¡œ ê° EC2ì— ë°°í¬

ê° ì„œë¹„ìŠ¤ì—ëŠ” ë” ë§ì€ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì´ ìˆìœ¼ë‹ˆ ì‚¬ìš©í•´ ë´…ì‹œë‹¤. ê·¸ë¦¬ê³  ë‚˜ì•„ê°€ ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì™€ ë‹¤ë¥¸ ì„œë“œíŒŒí‹° í”„ë¡œê·¸ë¨ì„ í•¨ê»˜ ì‚¬ìš©í•´ CI/CDë¥¼ ë” ê³ ë„í™” í•´ë´ë„ ì¢‹ì„ë“¯ í•©ë‹ˆë‹¤! ğŸ˜Š
