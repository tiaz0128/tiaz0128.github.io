---
layout: post
date: 2024-05-17
catalogue: "python"
subject: "python"
title: "λ””μμΈ ν¨ν„΄ - μ±…μ„μ—°μ‡„"
excerpt: "μ±…μ„μ—°μ‡„(Chain of Responsibility) ν¨ν„΄μ— λ€ν•΄μ„ μ•μ•„λ³΄κ² μµλ‹λ‹¤."
author: tiaz
permalink: /python/9
tags: [python, λ””μμΈν¨ν„΄, μ±…μ„μ—°μ‡„]
---

## μ±…μ„μ—°μ‡„(Chain of Responsibility) ν¨ν„΄

---

μ±…μ„ μ—°μ‡„ ν¨ν„΄(Chain of Responsibility)μ€ ν–‰λ™ λ””μμΈ ν¨ν„΄ μ¤‘ ν•λ‚λ΅, κ°μ²΄λ“¤μ μ²΄μΈμ„ λ”°λΌ μ”μ²­μ„ μ „λ‹¬ν•κ³  μ²λ¦¬ν•λ” λ°©μ‹μΌλ΅ μ‘λ™ν•©λ‹λ‹¤. λ€ν‘μ μΌλ΅ μ•„λμ™€ κ°™μ€ μƒν™©μ— λ§μ΄ μ‚¬μ©λλ” ν¨ν„΄μ…λ‹λ‹¤.

### μ‚¬μ© μ‚¬λ΅€

- λ΅κΉ… μ‹μ¤ν…
- μ΄λ²¤νΈ μ²λ¦¬ μ‹μ¤ν…
- μ”μ²­ ν•„ν„°λ§ λ° μ²λ¦¬ (μ: μ›Ή μ„λ²„μ λ―Έλ“¤μ›¨μ–΄)
- μΉμΈ ν”„λ΅μ„Έμ¤ (μ: λ³΄κ³ μ„ μΉμΈ)

## λ³΄κ³ μ„ μΉμΈ

---

μ—¬κΈ°μ„λ” *'λ³΄κ³ μ„ μΉμΈ μ²λ¦¬'*λ¥Ό κµ¬ν„ν•΄λ³΄λ©΄μ„ μ±…μ„μ—°μ‡„ ν¨ν„΄μ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤.

### μƒν™©

μ‚¬μ›μ΄ μ‘μ„±ν• λ³΄κ³ μ„λ” ν€μ¥-μ‚¬μ¥μ„ ν†µν•΄ μµμΆ… μΉμΈλ©λ‹λ‹¤. κµ³μ΄ μ‚¬μ¥μ μΉμΈκΉμ§€ ν•„μ”μ—†λ” λ³΄κ³ μ„λ” ν€μ¥μ΄ μµμΆ… μΉμΈν•λ” κ²½μ°λ„ μμµλ‹λ‹¤.

![λ³΄κ³ μ„ μΉμΈ](/assets/img/content/python/009/001.png){:.img-s}

### λ³΄κ³ μ„ ν΄λμ¤ (Report)

μ°μ„  λ³΄κ³ μ„ ν΄λμ¤λ¥Ό λ§λ“¤κ² μµλ‹λ‹¤. λ³΄κ³ μ„λ” λ‚΄μ©(*content*)κ³Ό μµμΆ… μΉμΈμ— ν•„μ”ν• μΉμΈ λ λ²¨(*required_approval_level*) μ†μ„±μ„ κ°€μ§‘λ‹λ‹¤.

```python
from enum import Enum, auto

class ApprovalLevel(Enum):
    TEAM_LEAD = auto()
    PRESIDENT = auto()

class Report:
    def __init__(self, content, required_approval_level: ApprovalLevel):
        self.content = content
        self.required_approval_level = required_approval_level
```

### κ²°μ¬μ μΈν„°νμ΄μ¤ (Approver)

μ”μ²­μ„ μ²λ¦¬ν•λ” ν•Έλ“¤λ¬(handler) μΈν„°νμ΄μ¤λ¥Ό μ •μν•©λ‹λ‹¤. κ²°μ¬μλ” μΉμΈ λ λ²¨κ³Ό λ‹¤μ κ²°μ¬μ(*next_approver*)λ¥Ό κ°€μ§‘λ‹λ‹¤. μ΄ next μ†μ„±κ°’ μ²΄μΈμ„ ν†µν•΄ λ³΄κ³ μ„λ¥Ό λ‹¨κ³„λ³„λ΅ μΉμΈ μ²λ¦¬ν•λ” κ²ƒμ΄μ£ .

```python
from abc import ABC, abstractmethod
from enum import Enum, auto

class Approver(ABC):
    def __init__(self, level: ApprovalLevel):
        self.level = level
        self.next_approver = None

    def set_next(self, approver):
        self.next_approver = approver
        return approver

    def process_report(self, report):
        is_approved = False
        if self.level.value <= report.required_approval_level.value:
            is_approved = self.approve(report)

        if self.next_approver and is_approved:
            return self.next_approver.process_report(report)
        return False

    @abstractmethod
    def approve(self, report):
        pass
```

- `set_next` : λ‹¤μ κ²°μ¬μλ¥Ό μ§€μ •ν•κ³  λ‹¤μ κ²°μ¬μ κ°μ²΄λ¥Ό λ‹¤μ‹ λ¦¬ν„΄. μ²΄μΈ λ§λ“¤λ• μ‚¬μ©
- `process_report`
  1. λ³΄κ³ μ„μ κ¶ν• λ λ²¨κ³Ό κ²°μ¬μμ κ¶ν•μ„ ν™•μΈ.
  2. μΉμΈμ²λ¦¬ κ²°κ³Όμ— λ”°λΌμ„
  3. λ‹¤μ κ²°μ¬μμ—κ² μΉμΈ μ”μ²­
- `approve` : κ²°μ¬μλ§λ‹¤ κµ¬μ²΄μ μΈ μΉμΈ λ°©λ²•

---

### κ° κ²°μ¬μ

μ„μ— λ§λ“  ν•Έλ“¤λ¬ μΈν„°νμ΄μ¤λ¥Ό μ‹¤μ  κµ¬ν„ν•λ” κµ¬μ²΄μ  ν•Έλ“¤λ¬(Concrete Handler)μΈ κ°κ°μ κ²°μ¬μ ν΄λμ¤λ¥Ό λ§λ“­λ‹λ‹¤. κ° κ²°μ¬μμ `approve`λ¥Ό κµ¬ν„ν•΄μ¤λ‹λ‹¤.

```python
from random import choice

class TeamLead(Approver):
    def __init__(self):
        super().__init__(ApprovalLevel.TEAM_LEAD)

    def approve(self, report):
        is_approved = choice([True, False])
        approve_msg = 'μΉμΈ' if is_approved else 'λ°λ ¤'

        print(f'ν€μ¥μ΄ ~{report.content}~ λ³΄κ³ μ„λ¥Ό "{approve_msg}"ν–μµλ‹λ‹¤')
        return is_approved

class President(Approver):
    def __init__(self):
        super().__init__(ApprovalLevel.PRESIDENT)

    def approve(self, report):
        is_approved = choice([True, False])
        approve_msg = 'μΆ…κ²°' if is_approved else 'λ°λ ¤'

        print(f'μ‚¬μ¥μ΄ ~{report.content}~ λ³΄κ³ μ„λ¥Ό "{approve_msg}"ν–μµλ‹λ‹¤')

        return is_approved
```

### μ²΄μΈ μƒμ„±

μ΄μ  λ§λ“¤μ–΄λ‘” ν•Έλ“¤λ¬ κ°μ²΄λ“¤μ μ²΄μΈμ„ `set_next`λ¥Ό ν†µν•΄ λ§λ“¤μ–΄ μ¤λ‹λ‹¤. μ—¬κΈ°μ„ μ¤‘μ”ν•κ²ƒμ€ μ²΄μΈμ„ μ—°κ²°ν•λ” μμ„μ…λ‹λ‹¤. λ¨Όμ € ν€μ¥μ΄ λ³΄κ³ μ„λ¥Ό κ²€ν† ν•κ³  λ‹¤μμ— μ‚¬μ¥μ΄ κ²°μ¬ν•λ” κ²ƒ μ²λΌ, μ–΄λ–¤ κ°μ²΄μ—μ„ λ‹¤μ κ°μ²΄λ¥Ό μ—°κ²°ν• μ§€ μ‹ μ¤‘ν•κ² κ²°μ •ν•΄μ•Ό ν•©λ‹λ‹¤.

ν•„μ”μ— λ”°λΌμ„ λ‹¤λ¥Έ κ²°μ¬μλ¥Ό μ–Όλ§λ“  λ§λ“¤μ–΄ μ¶”κ°€ν•κ³  μ²΄μΈμΌλ΅ μ—°κ²° ν•  μ μμµλ‹λ‹¤.

```python
def setup_approval_chain():
    team_lead = TeamLead()
    president = President()

    team_lead.set_next(president)

    return team_lead
```

### ν΄λΌμ΄μ–ΈνΈ μ½”λ“

λ³΄κ³ μ„ κ°μ²΄λ¥Ό λ§λ“¤μ–΄μ„ μ „λ‹¬ν•©λ‹λ‹¤. λ³΄κ³ μ„ κ°μ²΄λ¥Ό μ²΄μΈ ν†µν•΄ λ‹¤μ κ²°μμ¬ κ°μ²΄μ— μ „λ‹¬ν•΄μ„ μΉμΈ μ μ°¨λ¥Ό μν–‰ν•©λ‹λ‹¤. λ‹¤μ κ²°μμ¬κ°€ μ—†μΌλ©΄ μ²΄μΈ μΆ…λ£ν•©λ‹λ‹¤.

ν•Έλ“¤λ¬μ—μ„ μ²λ¦¬ν•λ” λ΅μ§μ— λ”°λΌμ„ λ‹¤μ–‘ν•κ² κµ¬ν„μ΄ κ°€λ¥ν•©λ‹λ‹¤. '_μ—°κ°„ μ „λµ κ³„ν_' λ³΄κ³ μ„ κ°™μ€ κ²½μ°, `process_report`μ—μ„ κµ¬ν„μ— λ”°λΌ ν€μ¥μ΄ λ°λ ¤ν•λ©΄ μ‚¬μ¥μ—κ² λ³΄κ³ μ„κ°€ μ „λ‹¬λμ§€ μ•κ³  κ·Έλ€λ΅ μ²΄μΈμ€ μΆ…λ£λ‹λ‹¤.

```python
approval_chain = setup_approval_chain()

report1 = Report("μΌμΌ μ—…λ¬΄ λ³΄κ³ ", ApprovalLevel.TEAM_LEAD)
report3 = Report("μ—°κ°„ μ „λµ κ³„ν", ApprovalLevel.PRESIDENT)

approval_chain.process_report(report1)
approval_chain.process_report(report2)
```

```text
ν€μ¥μ΄ ~μΌμΌ μ—…λ¬΄ λ³΄κ³ ~ λ³΄κ³ μ„λ¥Ό "λ°λ ¤"ν–μµλ‹λ‹¤

ν€μ¥μ΄ ~μ—°κ°„ μ „λµ κ³„ν~ λ³΄κ³ μ„λ¥Ό "μΉμΈ"ν–μµλ‹λ‹¤
μ‚¬μ¥μ΄ ~μ—°κ°„ μ „λµ κ³„ν~ λ³΄κ³ μ„λ¥Ό "μΆ…κ²°"ν–μµλ‹λ‹¤
```

## ν΄λμ¤ λ‹¤μ΄μ–΄κ·Έλ¨

---

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'primaryColor': '#2a3844',
      'lineColor': '#fff',
      'primaryTextColor': '#fff',
      'tertiaryColor': '#fff'
    }
  }
}%%

classDiagram
    direction LR

    class Approver {
        &lt;&lt;abstract&gt;&gt;

        -level: ApprovalLevel
        -next_approver: Approver
        +set_next(approver: Approver)
        +approve(report: Report)*
    }

    class TeamLead {
        +approve(report: Report)
    }
    class President {
        +approve(report: Report)
    }

    Approver <|-- TeamLead
    Approver <|-- President

    TeamLead o-- President
</pre>

## μ •λ¦¬

---

### κµ¬μ΅° μ •λ¦¬

- ν•Έλ“¤λ¬(Handler): μ”μ²­μ„ μ²λ¦¬ν•λ” μΈν„°νμ΄μ¤λ¥Ό μ •μ
- κµ¬μ²΄μ  ν•Έλ“¤λ¬(Concrete Handler): μ”μ²­ μ²λ¦¬μ μ‹¤μ  κµ¬ν„μ„ λ‹΄λ‹Ή
- ν΄λΌμ΄μ–ΈνΈ(Client): μ²« λ²μ§Έ ν•Έλ“¤λ¬μ—κ² μ”μ²­

### μ‘λ™ λ°©μ‹

κ° ν•Έλ“¤λ¬λ” λ‹¤μ ν•Έλ“¤λ¬μ— λ€ν• μ°Έμ΅°λ¥Ό κ°€μ§‘λ‹λ‹¤. μ”μ²­μ΄ λ“¤μ–΄μ¤λ©΄ κ° ν•Έλ“¤λ¬λ” κ·Έ μ”μ²­μ„ μ²λ¦¬ν•  μ μλ”μ§€ κ²°μ •ν•©λ‹λ‹¤. μ²λ¦¬λ¥Ό μν–‰ν•κ³  λ‹¤μ ν•Έλ“¤λ¬λ΅ μ”μ²­μ„ μ „λ‹¬ν•©λ‹λ‹¤. μ²΄μΈμ λμ— λ„λ‹¬ν•κ±°λ‚ μ”μ²­μ΄ μ²λ¦¬λ  λ•κΉμ§€ μ΄ κ³Όμ •μ΄ κ³„μ†λ©λ‹λ‹¤.

### κµ¬ν„ μ‹ κ³ λ ¤μ‚¬ν•­

- μ²΄μΈμ μΆ…λ£ μ΅°κ±΄μ„ λ…ν™•ν μ„¤μ •
- μ²΄μΈμ μμ„κ°€ μ¤‘μ”ν•  μ μμΌλ―€λ΅ μ‹ μ¤‘ν μ„¤κ³„

## λ” ν•΄λ³Ό κ²ƒ

---

μ±…μ„μ—°μ‡„(Chain of Responsibility) ν¨ν„΄μ„ ν†µν•΄μ„ λ λ‹¤λ¥Έ λ‹¤μ–‘ν• λ¬Έμ λ¥Ό κµ¬ν„ν•΄λ³΄λ” κ²ƒλ„ μΆ‹μ„ λ“―ν•©λ‹λ‹¤. π

- λ™μ „ κ³„μ‚°κΈ° : μ£Όμ–΄μ§„ λΉ„μ©μ„ 500μ› λ¶€ν„° λ™μ „μ„ μ΄μ©ν•μ—¬ λ‡κ°μ”© ν•„μ”ν•μ§€ κ³„μ‚°
- λ΅κ±°(logger) : μ£Όμ–΄μ§„ λ λ²¨μ— λ”°λΌμ„ μ½μ†”, νμΌ, μ΄λ©”μΌ λ“±μ λ‹¨κ³„λ¥Ό λ†’μ΄λ©΄μ„ λ΅κΉ… λ‚΄μ©μ„ μ „λ‹¬
