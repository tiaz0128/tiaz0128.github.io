---
layout: post
date: 2024-10-19
catalogue: "python"
subject: "python"
title: "파이썬 쓰레드"
subtitle: "파이썬에서 쓰레드(Thread)와 락(Lock)에 대해 알아보겠습니다."
author: tiaz0128
permalink: /python/10
tags: [python, 쓰레드]
mermaid: true
---

## 프로그램(Program)

---

일반적으로 프로그램이란 하드 디스크(HDD), SSD 같은 디스크에 저장된 정적인 상태의 명령어 집합을 의미합니다. '정적인 상태'란 말은, 실행 중이지 않은 상태의 코드를 의미 합니다. 

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'lineColor': '#2196f3',
      'primaryTextColor': '#fff',
      'tertiaryColor': '#333'
    }
  }
}%%
flowchart LR
    subgraph "Hard Disk"
        Program[Program]
    end
</pre>

그렇다면 '실행 중'이라는 상태는 어떤 것을 의미 할까요? 프로그램이 실행되면 어떻게 되는지 알아봅시다.

## 프로세스(Process)

---

프로그램이 실행되면 명령어들이 독립된 메모리 공간을 할당받습니다. 이런 상태를 '프로세스(Process)'라 합니다.

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'lineColor': '#2196f3',
      'primaryTextColor': '#fff',
      'tertiaryColor': '#333'
    }
  }
}%%
flowchart LR
    subgraph "Hard Disk"
        Program[Program]
    end

    subgraph "Memory"
        Process[Process]
    end

    Program --- Process
</pre>

### 여러개의 프로세스

같은 프로그램을 여러번 실행하여 프로세스는 여러개가 만들어 질 수 있습니다. 각각의 프로세스는 독립된 자원(메모리 등)을 가집니다. 노드패드를 여러개 실행한 상황을 생각해봅시다. *Notepad A*에 입력한 글자가 다른 *Notepad B*에 전혀 영향을 주지않습니다.

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'lineColor': '#2196f3',
      'primaryTextColor': '#fff',
      'tertiaryColor': '#333'
    }
  }
}%%
flowchart LR
    subgraph "Hard Disk"
        Program[Program]
    end

    subgraph "Memory"
        Process1[Notepad A]
        Process2[Notepad B]
    end

    Program --- Process1
    Program --- Process2
</pre>

### 프로세스의 메모리 구성

프로세스는 메모리를 크게 4가지의 영역으로 나누어 사용합니다.

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'lineColor': '#2196f3',
      'primaryTextColor': '#000',
      'tertiaryColor': '#333'
    }
  }
}%%
flowchart TB
    subgraph "Memory"
        subgraph "Process"
            CS1[Code Section]
            DS1[Data Section]
            HS1[Heap Section]
            SS1[Stack Section]
        end
    end

    style CS1 fill:#bbf,stroke:#333,stroke-width:1px
    style DS1 fill:#ddf,stroke:#333,stroke-width:1px
    style HS1 fill:#ffd,stroke:#333,stroke-width:1px
    style SS1 fill:#dfd,stroke:#333,stroke-width:1px
</pre>

- 코드 영역(Code Section) : 실행 코드
- 데이터 영역(Data Section) : 전역 변수/정적 변수
- 힙 영역(Heap Section) : 동적 메모리 할당 영역
- 스택 영역(Stack Section) : 지역 변수, 함수 호출 정보

## 쓰레드(Thread)

---

프로세스는 메모리를 할당 받아 명령어를 실행할 수 있는 상태를 뜻했습니다. 그렇다면 프로세스에서 누가 명령어를 실행하는 걸까요? 바로 쓰레드(Thread)가 그 역할을 수행합니다.

> thread
> 1. 실 <br/>
> 2. (이야기 등의) 가닥[맥락] <br/>
> 3. (실 등을) 꿰다 <br/>

쓰레드는 프로세스 내에서 실행되는 작은 실행 단위를 의미합니다. 단어의 뜻처럼 "실행의 흐름" 또는 "제어의 흐름"라고 생각하면 됩니다. 그리고 프로세스는 최소 1개 이상의 쓰레드를 포함합니다.

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'lineColor': '#2196f3',
      'primaryTextColor': '#000',
      'tertiaryColor': '#333'
    }
  }
}%%
flowchart BT
    subgraph "Memory"
        subgraph "Process"
            T11[Thread 1]
            CODE1[code]
            CODE2[code]
        end
    end

    T11 --- CODE1
    CODE1 --- CODE2

    style T11 fill:#fff,stroke:#333,stroke-width:1px
    style CODE1 fill:#bbf,stroke:#333,stroke-width:1px
    style CODE2 fill:#bbf,stroke:#333,stroke-width:1px
</pre>

### 쓰레드의 특징

- 같은 프로세스 내의 쓰레드들은 자원을 공유
- 스택만 따로 할당받고 나머지 자원은 프로세스 내에서 공유
- 다중 쓰레드로 병렬 처리 가능

## 파이썬 쓰레드 사용

---

threading 모듈 소개
기본적인 쓰레드 생성 및 실행 예제

## 멀티 쓰레드(Multi Thread)

---

여러 쓰레드를 동시에 실행하는 기법
동시성 vs 병렬성

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'lineColor': '#2196f3',
      'primaryTextColor': '#000',
      'tertiaryColor': '#333'
    }
  }
}%%
flowchart BT
    subgraph "Memory"
        subgraph "Process"
            T11[Thread 1]
            T12[Thread 2]

            CODE1[code]
            CODE2[code]
        end
    end

    T11 --- CODE1
    T12 --- CODE2

    style T11 fill:#fff,stroke:#333,stroke-width:1px
    style T12 fill:#fff,stroke:#333,stroke-width:1px
    style CODE1 fill:#bbf,stroke:#333,stroke-width:1px
    style CODE2 fill:#bbf,stroke:#333,stroke-width:1px
</pre>

### 멀티 쓰레딩의 장단점

자원 공유의 효율성
동기화 문제와 해결 방법

## 파이썬 멀티 쓰레드 구현

---

threading 모듈을 사용한 멀티 쓰레드 예제
쓰레드 간 통신 및 동기화 기법


<!-- ## 쓰레드 풀(Thread Pool)

---

### 쓰레드 풀의 개념

재사용 가능한 쓰레드 그룹 관리
작업 큐와 쓰레드 풀의 관계

### 파이썬에서의 쓰레드 풀 구현

concurrent.futures 모듈 소개
ThreadPoolExecutor 사용 예제

### 쓰레드 풀의 장점

자원 관리의 효율성
작업 분배와 실행의 간소화

---

## GIL (Global Interpreter Lock)

---

파이썬 인터프리터의 특징
GIL의 작동 원리

### GIL이 멀티 쓰레딩에 미치는 영향

CPU 바운드 작업에서의 한계
I/O 바운드 작업에서의 유용성

### GIL 우회 방법

멀티 프로세싱
외부 라이브러리 사용 (예: NumPy)

### python 3.13에서 GIL
 -->
