---
layout: post
date: 2024-12-08
catalogue: python
subject: pattern
title: "디자인 패턴 - 전략(Strategy)"
subtitle: "파이썬에서 전략(Strategy) 패턴을 배워 봅시다!"
author: tiaz0128
permalink: /python/11
tags: [python, 디자인 패턴, 팩토리]
mermaid: true
---

## 전략 패턴 (Strategy Pattern)

---

전략 패턴은 알고리즘군을 정의하고 캡슐화하여 각각의 알고리즘군을 상호 교체가 가능하도록 만드는 행동 디자인 패턴입니다. 이번 글에서는 결제 시스템을 예시로 전략 패턴에 대해 알아보겠습니다.

## 상황

---

온라인 쇼핑몰에서는 다양한 결제 방법(신용카드, 카카오페이, 네이버페이 등)을 제공합니다. 각 결제 방법은 서로 다른 처리 과정을 가지지만, 쇼핑몰 시스템은 어떤 결제 방법이 사용되든 동일한 방식으로 결제를 처리해야 합니다.

## 코드로 구현하기

---

먼저 모든 결제 전략이 따라야 할 인터페이스를 정의합니다:

```python
from abc import ABC, abstractmethod

class PaymentStrategy(ABC):
    @abstractmethod
    def pay(self, amount: int) -> bool:
        pass
```

다음으로 구체적인 결제 전략들을 구현합니다:

```python
class CreditCardPayment(PaymentStrategy):
    def __init__(self, card_number: str, expiry_date: str):
        self.card_number = card_number
        self.expiry_date = expiry_date
        
    def pay(self, amount: int) -> bool:
        print(f"{self.card_number}로 {amount}원 카드결제 진행")
        return True

class KakaoPayPayment(PaymentStrategy):
    def __init__(self, phone_number: str):
        self.phone_number = phone_number
        
    def pay(self, amount: int) -> bool:
        print(f"{self.phone_number}로 {amount}원 카카오페이 결제 진행")
        return True
        
class NaverPayPayment(PaymentStrategy):
    def __init__(self, user_id: str):
        self.user_id = user_id
        
    def pay(self, amount: int) -> bool:
        print(f"{self.user_id}로 {amount}원 네이버페이 결제 진행")
        return True
```

결제 전략을 사용하는 쇼핑카트 컨텍스트 클래스를 만듭니다:

```python
class ShoppingCart:
    def __init__(self):
        self.items = []
        self.payment_strategy = None
    
    def add_item(self, price: int):
        self.items.append(price)
        
    def set_payment_strategy(self, payment_strategy: PaymentStrategy):
        self.payment_strategy = payment_strategy
        
    def checkout(self) -> bool:
        if not self.payment_strategy:
            raise Exception("결제 방법을 선택해주세요")
            
        total = sum(self.items)
        return self.payment_strategy.pay(total)
```

### 사용 예시

```python
# 쇼핑카트 생성
cart = ShoppingCart()
cart.add_item(10000)  # 10,000원 상품
cart.add_item(20000)  # 20,000원 상품

# 카드 결제
card_payment = CreditCardPayment("1234-5678-9012-3456", "12/25")
cart.set_payment_strategy(card_payment)
cart.checkout()  # "1234-5678-9012-3456로 30000원 카드결제 진행"

# 카카오페이 결제
kakao_payment = KakaoPayPayment("010-1234-5678")
cart.set_payment_strategy(kakao_payment)
cart.checkout()  # "010-1234-5678로 30000원 카카오페이 결제 진행"
```

### 클래스 다이어그램

<pre class="mermaid center">
%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'primaryColor': '#2a3844',
      'lineColor': '#fff',
      'primaryTextColor': '#fff',
      'tertiaryColor': '#fff'
    }
  }
}%%
classDiagram
    direction LR
    
    class PaymentStrategy {
        &lt;&lt;interface&gt;&gt;
        +pay(amount: int)
    }
    
    class CreditCardPayment {
        -card_number: str
        -expiry_date: str
        +pay(amount: int)
    }
    
    class KakaoPayPayment {
        -phone_number: str
        +pay(amount: int)
    }
    
    class NaverPayPayment {
        -user_id: str
        +pay(amount: int)
    }
    
    class ShoppingCart {
        -items: List
        -payment_strategy: PaymentStrategy
        +add_item(price: int)
        +set_payment_strategy(strategy: PaymentStrategy)
        +checkout()
    }
    
    PaymentStrategy <|.. CreditCardPayment
    PaymentStrategy <|.. KakaoPayPayment
    PaymentStrategy <|.. NaverPayPayment
    ShoppingCart o-- PaymentStrategy
</pre>

## 전략 패턴의 장점

---

### 유연성과 확장성

- 새로운 결제 방법을 추가할 때 기존 코드를 수정하지 않고도 새로운 전략 클래스만 추가하면 됩니다.
- 예를 들어 토스페이를 추가하고 싶다면 `TossPayPayment` 클래스만 새로 구현하면 됩니다.

### 코드 재사용

- 동일한 전략을 다른 컨텍스트에서도 사용할 수 있습니다.
- 결제 전략들은 쇼핑몰뿐만 아니라 티켓 예매, 공과금 납부 등 다른 시스템에서도 재사용할 수 있습니다.

### 관심사의 분리

- 결제 처리 알고리즘과 이를 사용하는 쇼핑카트 로직이 분리되어 있어 각각 독립적으로 변경할 수 있습니다.

## 적용하면 좋은 경우

---

1. 비슷한 역할을 하는 알고리즘군이 존재하는 경우
2. 런타임에 알고리즘을 선택하고 교체해야 하는 경우
3. 알고리즘의 변형이 자주 발생하는 경우
4. 알고리즘의 구현 상세를 클라이언트로부터 숨기고 싶은 경우

## 결론

---

전략 패턴은 알고리즘의 교체와 확장이 자주 일어나는 상황에서 유용한 디자인 패턴입니다. 결제 시스템 외에도 다양한 정렬 알고리즘, 파일 압축 방식, 할인 정책 등 여러 상황에서 활용할 수 있습니다. 특히 객체지향의 핵심 원칙 중 하나인 개방-폐쇄 원칙(OCP)을 잘 따르는 패턴이므로, 확장성 있는 시스템을 설계할 때 고려해볼 만한 패턴입니다.
