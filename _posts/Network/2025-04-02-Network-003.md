---
layout: post
ins_date: 2025-04-02
upd_date: 2025-04-02
category: "Network"
subject: "Network"
title: "OSI 7계층과 TCP/IP"
description: "현대 네트워크의 핵심인 TCP/IP 모델을 실습을 통해 깊이 이해해보고자 합니다. 각 계층마다 어떤 방식으로 접근하고 공부하면 좋을지, 실습으로 따라해봅시다."
subtitle: "실습으로 알아보는 OSI 7계층과 TCP/IP"
author: tiaz0128
permalink: /Network/3
tags: [OSI7, TCP/IP]
---

## OSI 7계층



## TCP/IP 모델이란?

TCP/IP는 인터넷과 네트워크 통신의 기반이 되는 프로토콜 스택으로, OSI 7계층 모델을 실질적으로 구현한 형태라고 볼 수 있습니다. 크게 4계층(응용, 전송, 인터넷, 네트워크 인터페이스)으로 구성되어 있습니다.

각 계층이 맡은 역할을 실습을 통해 익히면 네트워크 동작 원리를 더 깊이 이해할 수 있습니다. 이번 포스트에서는 TCP/IP 각 계층을 실습 공부해보겠습니다.

## TCP/IP 프로토콜 스택

TCP/IP는 다음과 같은 4계층으로 구성됩니다.

1. 응용 계층 (Application Layer): HTTP, FTP, SMTP 등 사용자와 직접 상호작용하는 프로토콜.
2. 전송 계층 (Transport Layer): TCP와 UDP로 데이터 전송의 신뢰성 또는 속도를 조절.
3. 인터넷 계층 (Internet Layer): IP를 통해 데이터의 경로를 설정하고 패킷을 전달.
4. 네트워크 인터페이스 계층 (Network Interface Layer): 물리적 네트워크와의 연결을 담당.

이제 각 계층을 실습으로 어떻게 공부할지 알아보겠습니다.

## 계층별 실습 가이드

### 1. 응용 계층 (Application Layer)

- 공부 포인트: HTTP 요청/응답, DNS 쿼리, 이메일 전송 등 사용자 중심의 동작 이해.
- 실습 방법:
  - Wireshark로 HTTP 트래픽 캡처: 브라우저에서 웹사이트를 열고, Wireshark로 요청과 응답을 분석해보세요. 헤더와 상태 코드를 확인하며 동작 방식을 익힙니다.
  - 간단한 클라이언트-서버 구현: Python의 `socket` 모듈로 간단한 채팅 프로그램을 만들어 HTTP와 비슷한 요청-응답 구조를 체험합니다.
  - DNS 쿼리 확인: `nslookup` 또는 `dig` 명령어로 도메인 이름을 IP로 변환하는 과정을 실습합니다.

### 2. 전송 계층 (Transport Layer)

- 공부 포인트: TCP의 신뢰성(3-way handshake, 재전송)과 UDP의 경량화 이해.
- 실습 방법:
  - TCP 연결 관찰: Wireshark로 TCP 3-way handshake(SYN, SYN-ACK, ACK)를 캡처하고, 패킷 손실 시 재전송 과정을 확인합니다.
  - UDP 스트리밍 테스트: Python으로 UDP 소켓을 사용해 간단한 데이터 스트리밍을 구현하고, TCP와 달리 손실이 발생하는지 확인합니다.
  - 포트 스캔: `nmap`으로 특정 호스트의 열린 포트를 확인하며 TCP/UDP 포트의 역할을 이해합니다.

### 3. 인터넷 계층 (Internet Layer)

- 공부 포인트: IP 주소, 라우팅, 패킷 분할/재조립.
- 실습 방법:
  - 핑과 트레이서트: `ping`으로 패킷 왕복 시간을 측정하고, `tracert`(Windows) 또는 `traceroute`(Linux)로 패킷 경로를 추적합니다.
  - IP 헤더 분석: Wireshark에서 IP 패킷을 캡처해 TTL, 프로토콜 필드 등을 확인하며 라우팅 과정을 이해합니다.
  - 가상 네트워크 구축: GNS3나 Packet Tracer로 소규모 네트워크를 만들어 IP 주소 할당과 라우팅 테이블을 설정해봅니다.

### 4. 네트워크 인터페이스 계층 (Network Interface Layer)

- 공부 포인트: MAC 주소, 이더넷 프레임, ARP 프로토콜.
- 실습 방법:
  - ARP 동작 확인: `arp -a` 명령어로 ARP 테이블을 확인하고, Wireshark로 ARP 요청/응답을 캡처합니다.
  - 이더넷 프레임 분석: Wireshark로 캡처한 패킷에서 MAC 주소를 확인하며 물리적 계층과 데이터 링크 계층의 연결을 이해합니다.
  - 로컬 네트워크 테스트: 두 대의 PC를 직접 연결해 이더넷 케이블로 통신하며 프레임 전송을 실습합니다.

## 인캡슐레이션과 디캡슐레이션

데이터가 송신 측에서 수신 측으로 전달될 때, 각 계층에서 헤더가 추가되는 인캡슐레이션과 수신 측에서 헤더가 제거되는 디캡슐레이션 과정을 이해하는 것도 중요합니다.

- 실습 아이디어: Wireshark로 단일 패킷을 캡처해 계층별 헤더(예: 이더넷, IP, TCP, HTTP)가 어떻게 쌓이고 해체되는지 추적해보세요. 송신부터 수신까지의 과정을 시각화하면 개념이 더 명확해집니다.

## 실습 목표

docker-compose를 사용해 두 개의 컨테이너(alpine1, alpine2)를 생성하고, 동일한 사용자 정의 네트워크에서 통신하도록 설정합니다.

alpine1에서 alpine2로 ping을 보내 ARP 요청과 응답을 유도합니다.

Wireshark로 ARP 패킷을 캡처하고 분석합니다.


## 마무리

TCP/IP 모델은 네트워크의 기본이지만, 단순히 이론만으로는 이해하기 어렵습니다. 위 실습을 통해 각 계층의 역할을 직접 체험하며, 네트워크가 어떻게 동작하는지 몸으로 익혀보세요. 질문이 있다면 언제든 댓글로 남겨주시고, 다음 포스트에서 더 깊은 주제를 다뤄보겠습니다!

Docker Compose를 활용한 ARP 실습
1. 실습 환경 준비
필요한 도구
도커: 도커가 설치되어 있어야 합니다. Ubuntu 기준 설치 명령어:

sudo apt update
sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker

Docker Compose: docker-compose가 설치되어 있어야 합니다. 설치 명령어:

sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

설치 확인:

docker-compose --version

Wireshark: ARP 패킷을 캡처하고 분석하기 위해 필요합니다. 이미 설치되어 있다고 가정합니다.

tcpdump: 컨테이너 내부에서 패킷을 캡처하기 위해 사용합니다 (선택 사항).

실습 목표
docker-compose를 사용해 두 개의 컨테이너(alpine1, alpine2)를 생성하고, 동일한 사용자 정의 네트워크에서 통신하도록 설정합니다.

alpine1에서 alpine2로 ping을 보내 ARP 요청과 응답을 유도합니다.

Wireshark로 ARP 패킷을 캡처하고 분석합니다.

2. Docker Compose 설정
docker-compose.yaml 파일을 작성해 실습 환경을 정의합니다. 이 파일은 컨테이너와 네트워크 설정을 포함합니다.
1) docker-compose.yaml 파일 생성
작업 디렉토리를 생성하고 docker-compose.yaml 파일을 작성합니다:

mkdir arp-docker-compose
cd arp-docker-compose
nano docker-compose.yaml

다음 내용을 docker-compose.yaml에 작성합니다:
yaml

version: '3.8'
services:
  alpine1:
    image: alpine:latest
    container_name: alpine1
    command: sh -c "apk add iputils-ping && sleep infinity"
    networks:
      - arp-test-network
    cap_add:
      - NET_ADMIN  # ARP 캐시 조작 및 네트워크 작업을 위해 필요
    volumes:
      - ./captures:/captures  # 캡처 파일 저장을 위한 볼륨

  alpine2:
    image: alpine:latest
    container_name: alpine2
    command: sh -c "apk add iputils-ping && sleep infinity"
    networks:
      - arp-test-network
    cap_add:
      - NET_ADMIN
    volumes:
      - ./captures:/captures

networks:
  arp-test-network:
    driver: bridge
    name: arp-test-network

volumes:
  captures:  # 호스트와 컨테이너 간 파일 공유를 위한 볼륨

설정 설명
services: 두 개의 서비스(alpine1, alpine2)를 정의합니다.
image: alpine:latest: 경량화된 alpine 이미지를 사용합니다.

command: 컨테이너 시작 시 iputils-ping 패키지를 설치하고, 컨테이너가 종료되지 않도록 sleep infinity를 실행합니다.

cap_add: NET_ADMIN: ARP 캐시를 조작하거나 네트워크 관련 작업을 수행하기 위해 필요한 권한을 부여합니다.

volumes: 호스트와 컨테이너 간 파일 공유를 위해 ./captures 디렉토리를 /captures로 마운트합니다.

networks: 사용자 정의 브리지 네트워크 arp-test-network를 생성합니다.

volumes: 캡처 파일을 저장할 볼륨을 정의합니다.

2) 캡처 파일 저장 디렉토리 생성
호스트에서 캡처 파일을 저장할 디렉토리를 생성합니다:

mkdir captures

3. Docker Compose 실행
docker-compose를 사용해 컨테이너를 실행합니다.
1) 컨테이너 실행
작업 디렉토리에서 다음 명령어를 실행합니다:

docker-compose up -d

-d: 백그라운드에서 실행합니다.

실행 후 docker ps로 컨테이너가 실행 중인지 확인:

docker ps

출력 예:

CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS     NAMES
abc123def456   alpine:latest  "sh -c 'apk add iput…"   2 minutes ago   Up 2 minutes             alpine1
def456abc123   alpine:latest  "sh -c 'apk add iput…"   2 minutes ago   Up 2 minutes             alpine2

2) 컨테이너 IP 확인
각 컨테이너의 IP 주소를 확인합니다:

docker inspect alpine1 | grep IPAddress
docker inspect alpine2 | grep IPAddress

출력 예:

"IPAddress": "172.18.0.2"  # alpine1
"IPAddress": "172.18.0.3"  # alpine2

arp-test-network는 기본적으로 172.18.0.0/16 서브넷을 사용합니다.
4. ARP 트래픽 캡처
ARP 패킷을 캡처하는 두 가지 방법을 설명드리겠습니다: 호스트에서 Wireshark로 캡처하는 방법과 컨테이너 내부에서 tcpdump로 캡처하는 방법입니다.
방법 1: 호스트에서 Wireshark로 캡처
도커 브리지 인터페이스 확인:

ip link

출력에서 br-로 시작하는 인터페이스를 찾습니다. arp-test-network에 해당하는 브리지 이름을 확인:

docker network inspect arp-test-network

출력에서 com.docker.network.bridge.name 필드를 확인하면 브리지 이름(예: br-abcdef123456)을 알 수 있습니다.

Wireshark 실행:

sudo wireshark

인터페이스 선택:
Wireshark에서 br-abcdef123456 인터페이스를 선택하고 캡처를 시작합니다.

ARP 필터 적용:
Wireshark 필터 창에 arp를 입력하고 Enter를 누릅니다.

ARP 트래픽 유도:
alpine1에서 alpine2로 ping 실행:

docker exec -it alpine1 ping 172.18.0.3

ping을 실행하면 alpine1이 alpine2의 MAC 주소를 알아내기 위해 ARP 요청을 보냅니다.

Wireshark에서 ARP 패킷 확인:
ARP 요청: Who has 172.18.0.3? Tell 172.18.0.2

ARP 응답: 172.18.0.3 is at 02:42:ac:12:00:03

방법 2: 컨테이너 내부에서 tcpdump로 캡처
컨테이너 내부에서 직접 패킷을 캡처하고, 캡처 파일을 호스트로 복사해 Wireshark로 분석합니다.
tcpdump 설치:
alpine1에 tcpdump를 설치합니다:

docker exec -it alpine1 sh
apk add tcpdump

ARP 패킷 캡처:
alpine1에서 tcpdump를 사용해 ARP 패킷을 캡처하고 파일로 저장합니다:

tcpdump -i eth0 arp -w /captures/arp_capture.pcap

-i eth0: 컨테이너의 네트워크 인터페이스(기본적으로 eth0).

-w /captures/arp_capture.pcap: 캡처 파일을 /captures 디렉토리에 저장.

ARP 트래픽 유도:
다른 터미널에서 alpine1에서 alpine2로 ping을 실행합니다:

docker exec -it alpine1 ping 172.18.0.3

ping을 실행하면 ARP 요청이 발생합니다. tcpdump가 캡처 중이므로 몇 초 후 Ctrl+C로 캡처를 중지합니다.

캡처 파일 확인:
tcpdump를 중지한 후, 호스트의 ./captures 디렉토리에 arp_capture.pcap 파일이 생성되었는지 확인합니다:

ls captures/

출력 예:

arp_capture.pcap

Wireshark로 분석:
호스트에서 Wireshark로 캡처 파일을 엽니다:

wireshark captures/arp_capture.pcap

Wireshark에서 arp 필터를 적용해 ARP 패킷을 확인합니다.

5. ARP 캐시 조작 (선택 사항)
ARP 요청을 더 명확히 관찰하기 위해 ARP 캐시를 지우고 새로운 요청을 유도할 수 있습니다.
ARP 캐시 확인:
alpine1에서 ARP 캐시를 확인합니다:

docker exec -it alpine1 ip neigh show

ARP 캐시 지우기:
ARP 캐시를 지워 새로운 ARP 요청을 유도합니다:

docker exec -it alpine1 ip -s -s neigh flush all

다시 ping 실행:
ARP 캐시를 지운 후 다시 ping을 실행하면 새로운 ARP 요청이 발생합니다:

docker exec -it alpine1 ping 172.18.0.3

Wireshark 또는 tcpdump로 확인:
위에서 설정한 방법으로 ARP 패킷을 캡처하고 분석합니다.

6. 실습 환경 정리
실습이 끝난 후 환경을 정리합니다:

docker-compose down

docker-compose down은 컨테이너와 네트워크를 모두 제거합니다.

볼륨은 자동으로 삭제되지 않으므로, 필요 시 수동으로 삭제:

docker volume rm arp-docker-compose_captures

7. Docker Compose를 사용한 개선점
간편한 설정: docker-compose.yaml 파일 하나로 컨테이너와 네트워크를 정의해 한 번의 명령어(docker-compose up)로 실행 가능.

파일 공유: 볼륨을 사용해 캡처 파일을 호스트와 컨테이너 간 쉽게 공유.

재사용성: docker-compose.yaml 파일을 공유하면 누구나 동일한 환경에서 실습 가능.

관리 용이성: 컨테이너와 네트워크를 개별적으로 관리할 필요 없이 docker-compose로 통합 관리.

8. 추가 팁
컨테이너에 고정 IP 설정:
docker-compose.yaml에서 각 컨테이너에 고정 IP를 설정할 수 있습니다:
yaml

networks:
  arp-test-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.18.0.0/16
services:
  alpine1:
    networks:
      arp-test-network:
        ipv4_address: 172.18.0.2
  alpine2:
    networks:
      arp-test-network:
        ipv4_address: 172.18.0.3

고정 IP를 설정하면 IP 주소가 변경되지 않아 실습이 더 예측 가능해집니다.

디버깅 컨테이너 추가:
docker-compose.yaml에 네트워크 디버깅용 컨테이너를 추가할 수 있습니다:
yaml

debug:
  image: nicolaka/netshoot
  container_name: debug
  command: sleep infinity
  networks:
    - arp-test-network
  cap_add:
    - NET_ADMIN
  volumes:
    - ./captures:/captures

nicolaka/netshoot 이미지는 네트워크 디버깅 도구(tcpdump, ip, ping 등)가 포함된 이미지입니다.

9. 결론
docker-compose를 사용하면 ARP 실습 환경을 더 간단하고 효율적으로 구성할 수 있습니다. docker-compose.yaml 파일로 컨테이너와 네트워크를 정의하고, 한 번의 명령어로 실행한 후 Wireshark 또는 tcpdump로 ARP 패킷을 캡처해 분석할 수 있습니다. 이 방법은 환경 설정을 자동화하고 재현 가능성을 높여 어디서나 동일한 실습을 진행할 수 있도록 도와줍니다. 추가로 궁금한 점이 있다면 말씀해주세요!


