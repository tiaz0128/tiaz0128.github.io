---
layout: post
date: 2024-04-25
upd_date: 2025-01-23
category: "Couchbase"
subject: "Couchbase"
title: "Couchbase ì‹¤ë¬´ ë„ì…ê¸°"
description: "AWS DynamoDBë¥¼ S3 + Couchbase linkë¡œ ì „í™˜í•˜ëŠ” ì°"
author: tiaz0128
permalink: /Couchbase/2
tags: [Couchbase, NoSQL]
prev_post: /Couchbase/1
---

## í”„ë¡¤ë¡œê·¸

íšŒì‚¬ì— AWS DynamoDBë¥¼ ì´ìš©í•´ì„œ key-value í˜•íƒœë¡œ JSON ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë¡œì§ì„ ê°œë°œí–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ìš´ì˜ì„ í•´ë³´ë‹ˆ ê°œë°œê³¼ì •ì—ì„œëŠ” ìƒê°í•˜ì§€ ëª»í•œ ëª‡ê°€ì§€ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

1. ë¹„ìš©ì ì¸ ë¬¸ì œ
2. í•­ëª©ì˜ í¬ê¸° ì œí•œ
3. standalone ê°œë°œì˜ ì–´ë ¤ì›€

![í”¼ë…¸í‚¤ì˜¤ ì§¤](/assets/img/content/Couchbase/002/006.png){:.img-s}

`> ìƒê° ì´ìƒìœ¼ë¡œ DynamoDBëŠ” ë” ë¹„ì‹¸ë‹¤`{:.img-caption}

## DynamoDB ìš´ì˜ í•´ë³´ë‹ˆ

### 1. ë¹„ìš©ì ì¸ ë¬¸ì œ

**ìš°ì„  ê°€ì¥ í° ë¬¸ì œëŠ” ë¹„ìš©ì´ì˜€ìŠµë‹ˆë‹¤.**{:.yellow} ê° ì‚¬ìš©ìë³„ë¡œ í…Œë„ŒíŠ¸ë¥¼ ë¶„ë¦¬ë¥¼ ìœ„í•´ì„œ ê° ì‚¬ìš©ìë§ˆë‹¤ DynamoDBë¥¼ ìš´ì˜í•˜ë‹ˆ êµ‰ì¥íˆ ë§ì€ ë¹„ìš©ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

### 2. í•­ëª©ì˜ í¬ê¸° ì œí•œ

[í•˜ë‚˜ì˜ í•­ëª©ì˜ ìµœëŒ€ í¬ê¸°ê°€ 400KB ë¡œ ì œí•œ](https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/ServiceQuotas.html#limits-data-types){:target="_blank"}ì´ ìˆì—ˆê¸° ë•Œë¬¸ì— ë”ì´ìƒ ìª¼ê°¤ìˆ˜ ì—†ëŠ” JSON ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ”ë° ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

### 3. standalone ê°œë°œì˜ ì–´ë ¤ì›€

íšŒì‚¬ ì„œë¹„ìŠ¤ëŠ” SaaS í˜•íƒœ ì„œë¹„ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼ ì„¤ì¹˜ í˜•íƒœì˜ standalone ë˜í•œ ì œê³µí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  `amazon/dynamodb-local`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë¯¸ SaaSì—ì„œëŠ” ë¹„ìš©ì ì¸ ë¬¸ì œë¡œ ì œê±°í•˜ê¸°ë¡œ ê²°ë¡ ë‚œ ìƒí™©ì´ì˜€ê³ , standalone ê°œë°œì— DynamoDBë¥¼ ì‚¬ìš©í•´ë„ ì¶”í›„ ìœ ì§€ë³´ìˆ˜ì—ëŠ” ì¢‹ì§€ ì•Šì€ ì„ íƒì¼ í™•ë¥ ì´ ë†’ì•˜ìŠµë‹ˆë‹¤.

## Couchbase í™œìš©í•œ AWS ì•„í‚¤í…ì³

DynamoDBë¥¼ ì œê±°í•˜ê¸° ìœ„í•œ ì•„í‚¤í…ì³ì˜ í•µì‹¬ì€ S3ì— JSON ë°ì´í„°ë¥¼ ë³´ê´€í•˜ê³  ì´ë¥¼ í™œìš©í•˜ëŠ” ë°©ì•ˆì´ì˜€ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œ `Couchbase link` ê¸°ëŠ¥ì„ ë„ì…í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

![ì•„í‚¤í…ì³](/assets/img/content/Couchbase/002/005.png){:.img-m}
`> Couchbase link - s3`{:.img-caption}

## Couchbase link

[Managing Links](https://docs.couchbase.com/server/current/analytics/manage-links.html){:target="_blank"} í˜ì´ì§€ë¥¼ ì°¸ê³ í•´ì„œ Couchbase linkë¥¼ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.

ìš°ì„ ì€ ì™¼ìª½ ì‚¬ì´ë“œë°” `Analytics` íƒ­ì—ì„œ ë§í¬ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§í¬ë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ í•´ë‹¹ ë§í¬ì˜ ë¼ë²¨ì´ í‘œì‹œë˜ëŠ” ê²ƒì„ ì•Œìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ í¼ë¸”ë¦­ í´ë¼ìš°ë“œë¥¼ í™œìš©í•œ ì™¸ë¶€ ë§í¬ê°€ ëˆˆì— ë“¤ì–´ì˜¤ê³  ì—¬ê¸°ì„œëŠ” `S3`ì™€ ë§í¬ë¥¼ ìƒì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- `AZUREBLOB` : Microsoft Azure Blob storage
- `GCS` : Google Cloud Storage
- `S3` : Amazon S3 service

![Couchbase link](/assets/img/content/Couchbase/002/001.png){:.img-s}

### S3 ë§í¬ ìƒì„±

ë§í¬ë¥¼ ë§Œë“¤ë•Œ í•„ìš”í•œ ì •ë³´ëŠ” `Access Key ID`, `Secret Access Key`, `Region` ì…ë‹ˆë‹¤. í•„ìš”í•œ ê²½ìš° [ì„ì‹œ ìê²© ì¦ëª…](/AWS/1){:target="_blank"} `Session Token` ì •ë³´ê¹Œì§€ ì…ë ¥í•´ ì¤ë‹ˆë‹¤.

![Couchbase link](/assets/img/content/Couchbase/002/002.png){:.img-s}

### ì»¬ë ‰ì…˜(collection) ìƒì„±

ì´ì œ S3 ë²„í‚·ëª…ê³¼ ê²½ë¡œê°’ì„ ì´ìš©í•´ì„œ ì»¬ë ‰ì…˜ì„ ìƒì„±í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  íŠ¹ì • íŒŒì¼ í¬ë§·ê³¼ íŒŒì¼ëª…ì„ ì§€ì •í•´ì„œ ìƒì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![Couchbase link](/assets/img/content/Couchbase/002/003.png){:.img-s}

### S3 íŒŒì¼ ì—…ë¡œë“œ

ìœ„ ë²„í‚·ì— ì•„ë˜ì˜ ì½”ë“œë¡œ airline ì»¬ë ‰ì…˜ ë°ì´í„°ë¥¼ ê° íŒŒì¼ë¡œ ì €ì¥í•´ì„œ ì—…ë¡œë“œ í–ˆìŠµë‹ˆë‹¤.

```python
inventory_scope = self.bucket.scope("inventory")

sql_query = "SELECT RAW airline FROM airline"

row_iter = inventory_scope.query(
    sql_query,
    QueryOptions(positional_parameters=["airline"]),
)

for row in row_iter:
    key = row["type"] + str(row["id"])
    with open(f"{key}.json", "w") as fp:
        logging.info(row)
        json.dump(row, fp)
```

![Couchbase link](/assets/img/content/Couchbase/002/004.png){:.img-s}

`> S3 ë²„í‚·ì— JSON íŒŒì¼ ì—…ë¡œë“œ`{:.img-caption}

### SQL++

ì»¬ë ‰ì…˜ì´ ì œëŒ€ë¡œ ìƒì„±ëœ ê²½ìš°ì—ëŠ” ì´ì œ í•´ë‹¹ ë²„í‚·ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ì ¸ì˜¨ ë¬¸ì„œì˜ ë°ì´í„°ëŠ” SQL++ì„ ì´ìš©í•˜ì—¬ ì²˜ë¦¬ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```sql
SELECT country
     , count(country) as cnt
FROM airline
WHERE country IS NOT NULL
GROUP 
   BY country
```

## Couchbase link : SDK ê°œë°œ

ì•ì„œ Web Consoleì—ì„œ í–ˆë˜ ì‘ì—…ê³¼ ë™ì¼í•œ ì‘ì—…ì„ SDKë¥¼ ì´ìš©í•˜ì—¬ `python` ë¡œì§ìœ¼ë¡œ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.

### ì»¬ë ‰ì…˜(collection) ìƒì„±

Couchbase link ì»¬ë ‰ì…˜ì„ SQL++ ì—ì„œëŠ” `DATASET`ë¼ê³  í•©ë‹ˆë‹¤. _create_ ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆë˜ê²ƒ ì²˜ëŸ¼, `analytics_query` ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ DATASETì„ ìƒì„± í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
query = """
    CREATE EXTERNAL DATASET IF NOT EXISTS `tiaz0128`.`airline`
        ON `tiaz0128-couchbase-link` 
        AT `Default`.`tiaz0128` 
    USING "airline/"
    WITH {"format": "json", "include": "*.json"};
"""

result = cluster.analytics_query(query)
list(result)
result.metadata().status == "success"
```

### ë°ì´í„° ì¡°íšŒ : SQL++

ë™ì¼í•˜ê²Œ `analytics_query` ë©”ì„œë“œë¥¼ í†µí•´ SQL++ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
query = """
    SELECT country
         , count(country) as cnt
      FROM airline
     WHERE country IS NOT NULL
     GROUP 
        BY country
"""

result = self.cluster.analytics_query(query)
for row in result:
    print(row)
```

```text
{"count": 21,"country": "France"}
{"count": 39,"country": "United Kingdom"}
{"count": 127,"country": "United States"}
```

## ì—í•„ë¡œê·¸

JSON ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œ DynamoDBë¥¼ ì‹¤ì œ ìš´ì˜í™˜ê²½ì—ì„œ ì‚¬ìš©í–ˆì§€ë§Œ, ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. í•´ê²° ë°©ì•ˆì˜ í•µì‹¬ì€ í¬ê²Œ ë‘ ê°€ì§€ ì˜€ìŠµë‹ˆë‹¤.

- S3ì— ì‹¤ì œ JSON ë°ì´í„° ë³´ê´€
- Couchbase link ì´ìš©í•œ ë°ì´í„° ì¡°íšŒ

ì‹¤ì œ JSON ë°ì´í„°ëŠ” AWS S3ë¥¼ í™œìš©í•˜ê³  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ë•ŒëŠ” `Couchbase link`ë¥¼ í†µí•´ì„œ SQL++ì„ í™œìš©í•  ìˆ˜ ìˆì–´ì„œ ì¢‹ì€ ë°©ì‹ì¸ê±° ê°™ìŠµë‹ˆë‹¤.

ì•ìœ¼ë¡œ SQL++ í™œìš©ì„±ì„ ë†’ì¼ ìˆ˜ ìˆê²Œ ë°ì´í„° êµ¬ì¡°ë¥¼ ê°œì„ í•´ ë‚˜ê°ˆ ì˜ˆì •ì…ë‹ˆë‹¤! ğŸ˜Š
